name: Deploy Auth Service

on:
  push:
    paths:
      - 'backend/auth-service/**'
    branches:
      - main
      - develop

jobs:
  deploy:
    uses: ./.github/workflows/deploy-service-reusable.yml
    with:
      SERVICE_NAME: auth-service
      SHARED_MODULES: shared-dto,shared-exceptions
      DEPLOY_ENV: ${{ github.ref == 'refs/heads/main' && 'prod' || 'stage' }}
      GIT_BRANCH: ${{ github.ref == 'refs/heads/main' && 'main' || 'develop' }}
      COMPOSE_FILE: docker-compose.${{ github.ref == 'refs/heads/main' && 'prod' || 'stage' }}-auth-service.yml
    secrets:
      PROJECT_DIR: ${{ secrets.PROJECT_DIR }}

      SSH_HOST: ${{ github.ref == 'refs/heads/main' && secrets.PROD_DEPLOY_HOST || secrets.STAGE_DEPLOY_HOST }}
      SSH_USER: ${{ github.ref == 'refs/heads/main' && secrets.PROD_DEPLOY_USER || secrets.STAGE_DEPLOY_USER }}
      SSH_KEY: ${{ github.ref == 'refs/heads/main' && secrets.PROD_DEPLOY_KEY || secrets.STAGE_DEPLOY_KEY }}
      DEPLOY_PORT: ${{ secrets.DEPLOY_PORT }}

      SERVICE_SERVER_PORT: ${{ github.ref == 'refs/heads/main' && secrets.PROD_AUTH_SERVICE_SERVER_PORT || secrets.STAGE_AUTH_SERVICE_SERVER_PORT }}
      DB_NAME: ${{ github.ref == 'refs/heads/main' && secrets.PROD_AUTH_SERVICE_DB_NAME || secrets.STAGE_AUTH_SERVICE_DB_NAME }}
      DB_URL: ${{ github.ref == 'refs/heads/main' && secrets.PROD_AUTH_SERVICE_DB_URL || secrets.STAGE_AUTH_SERVICE_DB_URL }}
      DB_USER: ${{ github.ref == 'refs/heads/main' && secrets.PROD_AUTH_SERVICE_DB_USER || secrets.STAGE_AUTH_SERVICE_DB_USER }}
      DB_PASSWORD: ${{ github.ref == 'refs/heads/main' && secrets.PROD_AUTH_SERVICE_DB_PASSWORD || secrets.STAGE_AUTH_SERVICE_DB_PASSWORD }}
      SPRING_KAFKA_BOOTSTRAP_SERVERS: ${{ github.ref == 'refs/heads/main' && secrets.PROD_KAFKA_BOOTSTRAP_SERVERS || secrets.STAGE_KAFKA_BOOTSTRAP_SERVERS }}

      JWT_SECRET: ${{ github.ref == 'refs/heads/main' && secrets.PROD_JWT_SECRET || secrets.STAGE_JWT_SECRET }}
      JWT_REFRESH_SECRET: ${{ github.ref == 'refs/heads/main' && secrets.PROD_JWT_REFRESH_SECRET || secrets.STAGE_JWT_REFRESH_SECRET }}
      JWT_ADMIN_SECRET: ${{ github.ref == 'refs/heads/main' && secrets.PROD_JWT_ADMIN_SECRET || secrets.STAGE_JWT_ADMIN_SECRET }}
      JWT_ADMIN_REFRESH_SECRET: ${{ github.ref == 'refs/heads/main' && secrets.PROD_JWT_ADMIN_REFRESH_SECRET || secrets.STAGE_JWT_ADMIN_REFRESH_SECRET }}

      CORS_ALLOWED_ORIGINS: ${{ github.ref == 'refs/heads/main' && secrets.PROD_AUTH_SERVICE_CORS_ALLOWED_ORIGINS || secrets.STAGE_AUTH_SERVICE_CORS_ALLOWED_ORIGINS }}
